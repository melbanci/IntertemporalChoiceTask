<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <!-- Add any additional stylesheets or scripts here -->
</head>
<body>
    <div class="header">
        <h1 id="header-text">Intertemporal Choice Task</h1>
    </div>

    <h2 id="questionNum">Question 1 of 45</h2>

    <div id="content-div">
        <div id="questionDiv">
            <p id="question">Right now, which do you prefer?</p>
        </div>
    
        <div class="response-container">
            <button id="option1" class="optionButtons" onclick="selectOption(this, 'Option 1')">$0.20 this week</button>
            <button id="option2" class="optionButtons" onclick="selectOption(this, 'Option 2')">$0.70 in 1 week</button>
        </div>
    
         <p id="noResponseError" style="display: none;">Please make your selection</p>
    </div>

    <div id="button-container">
        <button class="navigationButtons" onclick="previousTrial()">Back</button>
        <button class="navigationButtons" onclick="nextTrial()">Answer</button>
        <button class="navigationButtons" onclick="skipTrial()">Skip</button>
    </div>

    <script>

        // first trial already displayed [0.20, 0.70, " in 1 week"]
        var trials= [
            [0.20, 0.70, " in 2 weeks"], [0.20, 0.70, " in 3 weeks"],
            [0.20, 1.20, " in 1 week"], [0.20, 1.20, " in 2 weeks"], [0.20, 1.20, " in 3 weeks"],
            [0.20, 2.20, " in 1 week"], [0.20, 2.20, " in 2 weeks"], [0.20, 2.20, " in 3 weeks"],
            [0.20, 4.20, " in 1 week"], [0.20, 4.20, " in 2 weeks"], [0.20, 4.20, " in 3 weeks"],
            [0.20, 6.60, " in 1 week"], [0.20, 6.60, " in 2 weeks"], [0.20, 6.60, " in 3 weeks"],
            [0.50, 1.00, " in 1 week"], [0.50, 1.00, " in 2 weeks"], [0.50, 1.00, " in 3 weeks"],
            [0.50, 1.50, " in 1 week"], [0.50, 1.50, " in 2 weeks"], [0.50, 1.50, " in 3 weeks"],
            [0.50, 2.50, " in 1 week"], [0.50, 2.50, " in 2 weeks"], [0.50, 2.50, " in 3 weeks"],
            [0.50, 4.50, " in 1 week"], [0.50, 4.50, " in 2 weeks"], [0.50, 4.50, " in 3 weeks"],
            [0.50, 6.50, " in 1 week"], [0.50, 6.50, " in 2 weeks"], [0.50, 6.50, " in 3 weeks"],
            [1.50, 2.00, " in 1 week"], [1.50, 2.00, " in 2 weeks"], [1.50, 2.00, " in 3 weeks"],
            [1.50, 2.50, " in 1 week"], [1.50, 2.50, " in 2 weeks"], [1.50, 2.50, " in 3 weeks"],
            [1.50, 3.50, " in 1 week"], [1.50, 3.50, " in 2 weeks"], [1.50, 3.50, " in 3 weeks"],
            [1.50, 5.50, " in 1 week"], [1.50, 5.50, " in 2 weeks"], [1.50, 5.50, " in 3 weeks"],
            [1.50, 6.50, " in 1 week"], [1.50, 6.50, " in 2 weeks"], [1.50, 6.50, " in 3 weeks"]
        ]
        var answers={}

        let trialNum = 1

        let currentSelectedOption=""

        function selectOption(button, response) {
            // Remove 'selected' class from all buttons
            var buttons = document.querySelectorAll('.response-container button');
            buttons.forEach(function(btn) {
                btn.classList.remove('selected');
            });

            // Add 'selected' class to the clicked button
            button.classList.add('selected');

            // Display the selected response
            console.log("You selected: " + response);
            currentSelectedOption = response
            console.log("currentSelectedOptionIs: " + currentSelectedOption);
        }
        
        function nextTrial() {
            if (trialNum < 45){  // only if we haven't reached max trials
                trialNum ++ 
                document.getElementById('questionNum').innerText= "Question " + trialNum + " of 45" //change trial num text
                nextTrialAnswer=answers[trialNum]

                //display corresponding questions
                var immediateOffer= trials[trialNum][0]
                var delayedOffer= trials[trialNum][1]
                var delay= trials[trialNum][2]

                document.getElementById('option1').innerText="$"+immediateOffer + " this week"
                document.getElementById('option2').innerText="$"+delayedOffer + delay

                if (nextTrialAnswer != undefined){  //user already answered this trial
                    //show previous answers
                    if (nextTrialAnswer=="now"){
                        document.getElementById('option1').classList.add('selected');
                        document.getElementById('option2').classList.remove('selected');
                    }
                    else if (nextTrialAnswer=="later"){
                        document.getElementById('option1').classList.remove('selected');
                        document.getElementById('option2').classList.add('selected');
                    }
                    else if (nextTrialAnswer=="skipped"){
                        document.getElementById('option1').classList.remove('selected');
                        document.getElementById('option2').classList.remove('selected');
                    }
                }
                else{  //user is answering this trial for the first time
                    if (currentSelectedOption!= "none"){ //user provided an answer
                        document.getElementById("noResponseError").style.display="none"
                        console.log("currentSelectedOption is ",currentSelectedOption)
                        if (currentSelectedOption=="Option 1"){
                            answers[trialNum]="now"
                        }
                        else if (currentSelectedOption=="Option 2"){
                            answers[trialNum]="later"
                        }
                        console.log("answers: ",answers)
                    }
                    else{ //user did not provide an answer
                        document.getElementById("noResponseError").style.display="flex" //show error message
                    }
                    //clear all answers for next answer
                    document.getElementById('option1').classList.remove('selected');
                    document.getElementById('option2').classList.remove('selected');
                    currentSelectedOption="none"
                }
            }
            else{
                console.log("experimentOver")
            }
        }

        //TODO: previous trial answer should be saved
        function previousTrial() {
            if (trialNum >1) {
                trialNum--
                document.getElementById('questionNum').innerText= "Question " + trialNum + " of 45" //change trial num text

                var immediateOffer= trials[trialNum][0]
                var delayedOffer= trials[trialNum][1]
                var delay= trials[trialNum][2]

                document.getElementById('option1').innerText="$"+immediateOffer + " this week"
                document.getElementById('option2').innerText="$"+delayedOffer + delay

                //retrieve answer from previous trial
                previousTrialAnswer=answers[trialNum]
                    //show previous answers
                    if (previousTrialAnswer=="now"){
                        document.getElementById('option1').classList.add('selected');
                        document.getElementById('option2').classList.remove('selected');
                    }
                    else if (previousTrialAnswer=="later"){
                        document.getElementById('option1').classList.remove('selected');
                        document.getElementById('option2').classList.add('selected');
                    }
                    else if (previousTrialAnswer=="skipped"){
                        document.getElementById('option1').classList.remove('selected');
                        document.getElementById('option2').classList.remove('selected');
                    }
            }
        }

        function skipTrial() {
            if (trialNum < 46) {     
                trialNum++
                document.getElementById('questionNum').innerText= "Question " + trialNum + " of 45" //change trial num text
           
                answers[trialNum]="skipped"   //record blank answer

                var immediateOffer= trials[trialNum+1][0]
                var delayedOffer= trials[trialNum+1][1]
                var delay= trials[trialNum+1][2]
                document.getElementById('option1').innerText="$"+immediateOffer + " this week"
                document.getElementById('option2').innerText="$"+delayedOffer + delay
            }
        }
    </script>
        
</body>
</html>